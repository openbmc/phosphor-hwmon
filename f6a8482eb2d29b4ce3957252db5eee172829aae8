{
  "comments": [
    {
      "key": {
        "uuid": "1c1d4ace_45914263",
        "filename": "xyz.openbmc_project.Hwmon@.service",
        "patchSetId": 10
      },
      "lineNbr": 8,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2021-03-15T16:16:58Z",
      "side": 1,
      "message": "Where does this end up coming from?  I don\u0027t see it in this or the parent commit.",
      "range": {
        "startLine": 8,
        "startChar": 47,
        "endLine": 8,
        "endChar": 62
      },
      "revId": "f6a8482eb2d29b4ce3957252db5eee172829aae8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c2a5b1ee_796ec828",
        "filename": "xyz.openbmc_project.Hwmon@.service",
        "patchSetId": 10
      },
      "lineNbr": 8,
      "author": {
        "id": 1000064
      },
      "writtenOn": "2021-03-15T16:28:45Z",
      "side": 1,
      "message": "It comes from:\nhttps://gerrit.openbmc-project.xyz/c/openbmc/openbmc/+/40359/3/meta-phosphor/classes/obmc-phosphor-image.bbclass line 116.",
      "parentUuid": "1c1d4ace_45914263",
      "range": {
        "startLine": 8,
        "startChar": 47,
        "endLine": 8,
        "endChar": 62
      },
      "revId": "f6a8482eb2d29b4ce3957252db5eee172829aae8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "eadeb2aa_daa47d08",
        "filename": "xyz.openbmc_project.Hwmon@.service",
        "patchSetId": 10
      },
      "lineNbr": 8,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2021-03-16T05:15:45Z",
      "side": 1,
      "message": "In that case, it seems like an environment would be more appropriate, no?  Otherwise this code doesn\u0027t do the sane thing without a co-req\u0027d change over in the recipe.",
      "parentUuid": "c2a5b1ee_796ec828",
      "range": {
        "startLine": 8,
        "startChar": 47,
        "endLine": 8,
        "endChar": 62
      },
      "revId": "f6a8482eb2d29b4ce3957252db5eee172829aae8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "79b1b9d2_7b836fc0",
        "filename": "xyz.openbmc_project.Hwmon@.service",
        "patchSetId": 10
      },
      "lineNbr": 8,
      "author": {
        "id": 1000064
      },
      "writtenOn": "2021-03-16T12:08:55Z",
      "side": 1,
      "message": "If variable is not set, that\u0027s a clear misconfiguration and makes the running service inaccessible for the callees because they will be refused due to missing busconfig ACLs that are generated by postprocess script: https://gerrit.openbmc-project.xyz/c/openbmc/openbmc/+/40359/3/meta-phosphor/classes/obmc-phosphor-image.bbclass\n\nEven if the variable is empty, the empty value of ${HW_SENSOR_ID} for ExecStart will be translated into an empty argument, that falls into default behavior: https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-hwmon/+/40214/10/mainloop.cpp line 376.\n\n```\nexecve(\"/usr/bin/phosphor-hwmon-readd\", [\"phosphor-hwmon-readd\", \"-i\", \"\", \"-o\", \"/ahb/apb/bus@1e78a000/i2c-bus@c0\"...], 0x7ead0dc0 /* 10 vars */) \u003d 0\n```",
      "parentUuid": "eadeb2aa_daa47d08",
      "range": {
        "startLine": 8,
        "startChar": 47,
        "endLine": 8,
        "endChar": 62
      },
      "revId": "f6a8482eb2d29b4ce3957252db5eee172829aae8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "854383ff_8a1c964b",
        "filename": "xyz.openbmc_project.Hwmon@.service",
        "patchSetId": 10
      },
      "lineNbr": 8,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2021-03-19T13:02:46Z",
      "side": 1,
      "message": "\u003e If variable is not set, that\u0027s a clear misconfiguration and makes the running service inaccessible for the callees because they will be refused due to missing busconfig ACLs that are generated by postprocess script\n\nYes, but that requires this script to also be merged at the same time as this commit, which likely won\u0027t happen.  My comment was an effort to avoid a dependency between this repository and code in another repository (ie. the recipe).  Having this kind of dependency means we cannot do integration-style testing in the future easily without later on duplicating that same content here, which means we should just put it here to begin with.\n\n\u003e Even if the variable is empty, the empty value of ${HW_SENSOR_ID} for ExecStart will be translated into an empty argument, that falls into default behavior: \n\nIf the variable is empty you will still have the \u0027-i\u0027, right?  And then CLI11 will fail parsing the argument.  Or does systemd do some magic where it passes an empty string, which sh would not normally do?  It seems dangerous to rely on that magic, if it exists.",
      "parentUuid": "79b1b9d2_7b836fc0",
      "range": {
        "startLine": 8,
        "startChar": 47,
        "endLine": 8,
        "endChar": 62
      },
      "revId": "f6a8482eb2d29b4ce3957252db5eee172829aae8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7b9e97e6_20c726b6",
        "filename": "xyz.openbmc_project.Hwmon@.service",
        "patchSetId": 10
      },
      "lineNbr": 8,
      "author": {
        "id": 1000064
      },
      "writtenOn": "2021-03-19T13:12:07Z",
      "side": 1,
      "message": "I have another changes to other repo that are incompatible with current recipe. It\u0027s almost impossible to make changes to the individual repo that will still work with current recipes (or requires a significant effort to do so). IMO, it\u0027s better to prioritize changes to openbmc meta to such changes. As long as we don\u0027t bump version in openbmc meta, individual repo\u0027s code will still work.\n\n\u003e If the variable is empty you will still have the \u0027-i\u0027, right?  And then CLI11 will fail parsing the argument. \n\nAs per strace output, the invoked command will have \"-i\" and empty string as params that are legal. I just wondering if CLI11 (in contrast with getopt()) do not allow empty values for the arguments.",
      "parentUuid": "854383ff_8a1c964b",
      "range": {
        "startLine": 8,
        "startChar": 47,
        "endLine": 8,
        "endChar": 62
      },
      "revId": "f6a8482eb2d29b4ce3957252db5eee172829aae8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9dc96154_d0b0dd18",
        "filename": "xyz.openbmc_project.Hwmon@.service",
        "patchSetId": 10
      },
      "lineNbr": 8,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2021-04-23T11:37:07Z",
      "side": 1,
      "message": "I think you\u0027re saying that strace shows the parameters should be:\n    -i \u0027\u0027\nAnd not just:\n    -i\n\nRight?\n\nIf there is no parameter for -i then CLI11 gets upset.\n\n$ ./a.out -i   \n-i: 1 required TEXT missing\nRun with --help for more information.\n\nSee https://gist.github.com/ef8ebfcc41d6ae84ad8ec9f52fff50ab for sample.",
      "parentUuid": "7b9e97e6_20c726b6",
      "range": {
        "startLine": 8,
        "startChar": 47,
        "endLine": 8,
        "endChar": 62
      },
      "revId": "f6a8482eb2d29b4ce3957252db5eee172829aae8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f215d671_d47373b4",
        "filename": "xyz.openbmc_project.Hwmon@.service",
        "patchSetId": 10
      },
      "lineNbr": 8,
      "author": {
        "id": 1000064
      },
      "writtenOn": "2021-04-23T11:59:39Z",
      "side": 1,
      "message": "The strace\u0027s output above when HW_SENSOR_ID is not set in env file. The systemd expands arguments differently within ExecStart rather then regular shell expansion.",
      "parentUuid": "9dc96154_d0b0dd18",
      "range": {
        "startLine": 8,
        "startChar": 47,
        "endLine": 8,
        "endChar": 62
      },
      "revId": "f6a8482eb2d29b4ce3957252db5eee172829aae8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bf45385a_f2c097ad",
        "filename": "xyz.openbmc_project.Hwmon@.service",
        "patchSetId": 10
      },
      "lineNbr": 8,
      "author": {
        "id": 1000064
      },
      "writtenOn": "2021-04-23T12:02:50Z",
      "side": 1,
      "message": "Just to highlight it:\n\n\u003e execve(\"/usr/bin/phosphor-hwmon-readd\", [\"phosphor-hwmon-readd\", \"-i\", \"\", \"-o\", \"/ahb/apb/bus@1e78a000/i2c-bus@c0\"...], 0x7ead0dc0 /* 10 vars */) \u003d 0\n\nThis is the execve() straced when service have been started without HW_SENSOR_ID being set in env file.",
      "parentUuid": "f215d671_d47373b4",
      "range": {
        "startLine": 8,
        "startChar": 47,
        "endLine": 8,
        "endChar": 62
      },
      "revId": "f6a8482eb2d29b4ce3957252db5eee172829aae8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "162cf085_3ffb3026",
        "filename": "xyz.openbmc_project.Hwmon@.service",
        "patchSetId": 10
      },
      "lineNbr": 8,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2021-04-23T13:54:29Z",
      "side": 1,
      "message": "I\u0027m surprised but ok!",
      "parentUuid": "bf45385a_f2c097ad",
      "range": {
        "startLine": 8,
        "startChar": 47,
        "endLine": 8,
        "endChar": 62
      },
      "revId": "f6a8482eb2d29b4ce3957252db5eee172829aae8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": false
    }
  ]
}